<project name="Tinak release." default="release">

	<target name="release">
		<property name="tinak.ant" value="../tinak/ant" />
		<property file="${tinak.ant}/build.properties" />
		<property name="release.distrib" value="milyn-tinak-${tinak.version}" />

		<!-- delete old releases, copy, jar and delete -->		
		<antcall target="clean" />
		<ant antfile="build.xml" target="clean" dir="${tinak.ant}" />
		<ant antfile="build.xml" target="build" dir="${tinak.ant}" />
		<ant antfile="build.xml" target="test" dir="${tinak.ant}" />
		<ant antfile="build.xml" target="javadoc" dir="${tinak.ant}" />
		<antcall target="deploy-javadocs" />

		<mkdir dir="${release.distrib}"/>
		<copy todir="${release.distrib}">
			<fileset dir="../tinak" excludes="**/classes/**, sourceforge/**, **/report/**, webapps/tinak-samples/**" />
		</copy>
        <zip destfile="../${release.distrib}.zip" basedir="." includes="${release.distrib}/**"/>
        <delete dir="${release.distrib}"/>
    </target>
	
	<!-- Deploy the Tinak javadoc to the www.milyn.org pages -->
	<target name="deploy-javadocs" description="Deploy Milyn Javadocs to Milyn Sourceforge Docs.">
		<delete dir="../www.milyn.org/tinak/api" excludes="cvsempty" />
		<copy todir="../www.milyn.org/tinak/">
			<fileset dir="../tinak/docs/" includes="api/**"/>
		</copy>
    </target>

	<target name="clean">
		<delete failonerror="false">
			<fileset file="../${release.distrib}.zip" />
			<fileset dir="${release.distrib}" />
		</delete>
	</target>
    
</project>

