<project name="junit-test" default="test">
	<description>JUnit Testing.</description>

    <!-- Set the properties. -->
	<property file="build.properties" />
	<property name="test.libs" value="${build.root}/../lib" />
	<property name="test.root" value="${build.root}/test/junit" />
	<property name="test.src" value="${test.root}/src" />
	<property name="test.classes" value="${test.root}/classes" />
	<property name="test.report" value="${test.root}/report" />

    <!-- Set the classpaths. -->
	<path id="build.classpath">
		<pathelement location="${test.classes}"/>
		<pathelement location="${test.src}"/>
		<pathelement location="${build.classes}"/>
		<fileset dir="${build.lib}" includes="*.jar"/>
		<fileset dir="${test.root}/lib" includes="*.jar"/>
	</path>
	<path id="test.classpath">
		<pathelement location="${test.classes}"/>
		<pathelement location="${test.src}"/>
		<fileset dir="${build.lib}" includes="*.jar"/>
		<fileset dir="${test.root}/lib" includes="*.jar"/>
	</path>


	<target name="test" depends="compile-tests" description="Execute JUnit Tests.">
		<delete dir="${test.report}" />
		<mkdir dir="${test.report}" />
		<junit printsummary="yes" failureproperty="test.unit.failure" fork="true" dir=".">
			<classpath refid="test.classpath" />

			<formatter type="xml"/>

			<batchtest fork="yes" todir="${test.report}">
				<fileset dir="${test.src}">
					<include name="**/*Test.java"/>
				</fileset>
			</batchtest>
		</junit>
		<junitreport todir="${test.report}">
			<fileset dir="${test.report}">
				<include name="TEST-*.xml"/>
			</fileset>
			<report todir="${test.report}"/>
		</junitreport>
		<antcall target="fail-on-test-failure" />
	</target>

	<target name="fail-on-test-failure" if="test.unit.failure">
		<fail message="Some unit tests have failed.  See report at: ${test.report}" />
	</target>

	<target name="compile-tests">
		<mkdir dir="${test.classes}" />
		<javac srcdir="${test.src}" destdir="${test.classes}" debug="on">
			<classpath refid="build.classpath" />
		</javac>
	</target>

	<target name="clean" description="Clean.">
		<delete quiet="true" dir="${test.classes}" />
		<delete quiet="true" dir="${test.report}" />
	</target>
</project>

