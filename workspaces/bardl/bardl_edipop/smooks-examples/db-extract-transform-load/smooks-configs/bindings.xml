<?xml version="1.0"?>
<smooks-resource-list xmlns="http://www.milyn.org/xsd/smooks-1.0.xsd">

    <!--
        Virtual Model Binding Configurations for the order message elements...

        Just capturing the order and order-item element details into 2
        Maps, overwriting each as we iterate through the message i.e. not
        accumulating them in memory => low memory footprint because we only
        have details of the current order + current order-item in memory
        at any given time (i.e. we never even have a full order in memory)...

        The Database Schema (need to capture enough from the message to populate this):
        ORDERS (ORDERNUMBER INTEGER, USERNAME VARCHAR(50), STATUS INTEGER, NET DOUBLE, TOTAL DOUBLE, ORDDATE DATE)
        ORDERITEMS (ORDERNUMBER INTEGER, QUANTITY INTEGER, PRODUCT INTEGER, TITLE VARCHAR(50), PRICE DOUBLE)
    -->

    <resource-config selector="message-header">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">message</param>
        <param name="beanClass">java.util.HashMap</param>
        <param name="bindings">
            <binding property="date" selector="message-header date" type="OrderDateDecoder" /> <!-- Defined below -->
        </param>
    </resource-config>

    <resource-config selector="order">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">order</param>
        <param name="beanClass">java.util.HashMap</param>
        <param name="bindings">
            <binding property="orderNum"      selector="order order-id"     type="Integer" />
            <binding property="customerUname" selector="order customer-details username" />
            <binding property="status"        selector="order status-code"  type="Integer" />
            <binding property="net"           selector="order net-amount"   type="BigDecimal" />
            <binding property="total"         selector="order total-amount" type="BigDecimal" />
        </param>
    </resource-config>

    <resource-config selector="order-item">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">orderItem</param>
        <param name="beanClass">java.util.HashMap</param>
        <param name="bindings">
            <!-- Just bind in all elements of the orderItem into the orderItem map.  Property name is
                 taken from the element name... -->
            <binding selector="order-item *" />
        </param>
    </resource-config>

    <resource-config selector="decoder:OrderDateDecoder">
        <resource>org.milyn.javabean.decoders.DateDecoder</resource>
        <param name="format">EEE MMM dd HH:mm:ss z yyyy</param>
    </resource-config>

</smooks-resource-list>