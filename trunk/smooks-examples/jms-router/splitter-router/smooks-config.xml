<?xml version="1.0"?>
<smooks-resource-list xmlns="http://www.milyn.org/xsd/smooks-1.1.xsd" xmlns:jb="http://www.milyn.org/xsd/smooks/javabean-1.1.xsd">

    <!--
    Filter the message using the SAX Filter (i.e. not DOM, so no
    intermediate DOM, so we can process huge messages...
    -->
    <params>
        <param name="stream.filter.type">SAX</param>
    </params>

    <resource-config selector="order,order-item">
        <resource>org.milyn.delivery.DomModelCreator</resource>
    </resource-config>

    <resource-config selector="order-item">
        <resource>org.milyn.routing.jms.JMSRouter</resource>
        <param name="executeBefore">false</param>
        <param name="beanId">orderItem_xml</param>
        <param name="destinationName">smooks.exampleQueue</param>
        <param name="highWaterMark">3</param>
        <param name="correlationIdPattern">${order.@id}-${.vars["order-item"].@id}</param> <!-- Need to use special FreeMarker variable ".vars" -->
    </resource-config>

    <resource-config selector="order-item">
        <!--
            Note in the template that we need to use the special FreeMarker variable ".vars"
            because of the hyphenated variable names ("order-item"). See http://freemarker.org/docs/ref_specvar.html.
        -->
        <resource>/orderitem-split.ftl</resource>
        <param name="action">bindto</param>
        <!-- The following config binds the templating result into the bean context, from where
             it can be accessed by the JMSRouter (configured above). -->
        <param name="bindId">orderItem_xml</param>
    </resource-config>

</smooks-resource-list>